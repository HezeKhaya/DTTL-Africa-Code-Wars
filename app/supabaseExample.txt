'use client'

import { useEffect, useState } from 'react'
import { supabase } from '../lib/supabaseClient'
import { Box, Heading, List, ListItem, Spinner } from '@chakra-ui/react'

type User = {
  id: number
  first_name: string
  last_name: string
  created_at: Date
  last_updated: Date
}

export default function Home() {
  const [users, setUsers] = useState<User[] | null>(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    async function getUsers() {
      const { data, error } = await supabase.from('User').select()
      console.log('Fetched users:', data, error)
      if (error) {
        console.error('Error fetching users:', error)
      } else {
        setUsers(data)
      }
      setLoading(false)
    }
    getUsers()
  }, [])

  if (loading) {
    return (
      <Box p={8} display="flex" justifyContent="center">
        <Spinner />
      </Box>
    )
  }

  return (
    <Box p={8}>
      <Heading mb={4}>My Users</Heading>
      <List.Root>
        {users && users.length > 0 ? (
          users.map((user) => <ListItem key={user.id}>{user.first_name}</ListItem>)
        ) : (
          <ListItem>No users found. Go add some in your Supabase table!</ListItem>
        )}
      </List.Root>
    </Box>
  )
}
